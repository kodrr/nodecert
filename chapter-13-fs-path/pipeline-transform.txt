"USE STRICT";
CONST { JOIN } = REQUIRE("PATH");
CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE("FS");
CONST { TRANSFORM, PIPELINE } = REQUIRE("STREAM");

CONST CREATEUPPERCASESTREAM = () => {
  RETURN NEW TRANSFORM({
    TRANSFORM(CHUNK, ENC, NEXT) {
      CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE();
      NEXT(NULL, UPPERCASED);
    },
  });
};

PIPELINE(
  CREATEREADSTREAM(__FILENAME),
  CREATEUPPERCASESTREAM(),
  CREATEWRITESTREAM(JOIN(__DIRNAME, "PIPELINE-TRANSFORM.TXT")),
  (ERR) => {
    IF (ERR) {
      CONSOLE.ERROR(ERR);
      RETURN;
    }
    CONSOLE.LOG("FINISH WRITING");
  }
);
